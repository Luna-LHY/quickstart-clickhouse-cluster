:xrefstyle: short

Deploying this Quick Start for a new virtual private cloud (VPC) with
default parameters builds the following {partner-product-short-name} environment in the
AWS Cloud.

// Replace this example diagram with your own. Follow our wiki guidelines: https://w.amazon.com/bin/view/AWS_Quick_Starts/Process_for_PSAs/#HPrepareyourarchitecturediagram. Upload your source PowerPoint file to the GitHub {deployment name}/docs/images/ directory in this repo. 

[#architecture1]
.Quick Start architecture for {partner-product-short-name} on AWS
image::../images/clickhouse_cluster_architecture_diagram.png[Architecture,width=100%,height=100%]

As shown in <<architecture1>>, the Quick Start sets up the following:

* A highly available architecture that spans two Availability Zones.*
* A VPC configured with public and private subnets, according to AWS
best practices, to provide you with your own virtual network on AWS.*
* In the public subnets:
** Managed *network address translation (NAT) gateways* to allow outbound
internet access for resources in the private subnets.*
** A *Linux bastion host* in an Auto Scaling group to allow inbound Secure
Shell (SSH) access to EC2 instances in public and private subnets.*
** An *Elastic IP address* is associated with the bastion host.*
** An *internet gateway* to allow internet access for bastion host.*
* In the private subnets:
** A *ClickHouse client host* to allow the administrator to connect to the ClickHouse cluster using command line and graphical interface.
** A *ClickHouse database cluster* that includes several EC2 instances. The default is two.
** A *Zookeeper cluster* that includes three EC2 instances. Metadata for ClickHouse replication is stored in ZooKeeper. Each replica stores its state in ZooKeeper as the set of parts and its checksums. The default is three.
** A *ELB using Network Load Balancer* that is in front of the ClickHouse cluster.
// Add bullet points for any additional components that are included in the deployment. Make sure that the additional components are also represented in the architecture diagram. End each bullet with a period.
* *Three Security Groups* are created, one for bastion and one for ClickHouse cluster and one for Zookeeper cluster.
** A bastion’s Security Group with specific IPs to the inbound rule to allow access from them.
** A ClickHouse’s Security Group, which add cluster communication port to the inbound rule.
** An Admin’s Security Group, which add graphical interface to the inbound rule.
* A private *S3 bucket* is created for tiered storage (local disk first and S3 with a move factor) of the ClickHouse cluster with the following naming rules: "clickhouse-data-vpcid".
* An *Amazon CloudWatch Logs* enables you to centralize the logs from the ClickHouse cluster and adjust the log retention policy.
* An *Amazon CloudWatch dashboard* to monitor the CPU, memory, disk IO and network on the EC2 instances in the ClickHouse and Zookeeper cluster, send an Amazon Simple Notification Service (Amazon SNS) email notification when the alarm is triggered.
** When CPU utilization (cpu_usage_user and cpu_usage_system from CloudWatch agent) higher than 90% and continue more than 5 minutes.
** When memory utilization (mem_used_percent from CloudWatch agent) higher than 90% and continue more than 5 minutes.
** Disk IOPS (diskio_writes and diskio_reads from CloudWatch agent).
** Network throughout (net_bytes_sent and net_bytes_recv from CloudWatch agent).

[.small]#* The template that deploys the Quick Start into an existing VPC skips the components marked by asterisks and prompts you for your existing VPC configuration.#
